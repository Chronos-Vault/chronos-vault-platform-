<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chronos Vault - System Health Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #050517;
      color: #e2e8f0;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #6B00D7 0%, #210045 100%);
    }
    .card {
      background-color: rgba(30, 30, 60, 0.8);
      border: 1px solid rgba(107, 0, 215, 0.3);
      box-shadow: 0 4px 20px rgba(107, 0, 215, 0.2);
    }
    .critical {
      background-color: rgba(220, 38, 38, 0.2);
      border-color: rgba(220, 38, 38, 0.5);
    }
    .high {
      background-color: rgba(234, 88, 12, 0.2);
      border-color: rgba(234, 88, 12, 0.5);
    }
    .medium {
      background-color: rgba(245, 158, 11, 0.2);
      border-color: rgba(245, 158, 11, 0.5);
    }
    .low {
      background-color: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
    }
    .optimal {
      background-color: rgba(16, 185, 129, 0.2);
      border-color: rgba(16, 185, 129, 0.5);
    }
    .good {
      background-color: rgba(16, 185, 129, 0.1);
      border-color: rgba(16, 185, 129, 0.3);
    }
    .degraded {
      background-color: rgba(245, 158, 11, 0.2);
      border-color: rgba(245, 158, 11, 0.5);
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex flex-col">
    <header class="gradient-bg py-4">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center">
            <h1 class="text-2xl font-bold text-white">Chronos Vault</h1>
            <span class="ml-2 text-purple-200 text-sm">System Health Dashboard</span>
          </div>
          <div class="text-white">
            <span id="current-time" class="text-sm">May 7, 2025 - 10:00:00</span>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 py-8 flex-grow">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- System Health Overview -->
        <div class="card rounded-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-purple-300">System Status</h2>
          <div id="system-status" class="mb-6 p-4 rounded-md flex items-center justify-between optimal">
            <div>
              <span id="status-label" class="font-bold">OPTIMAL</span>
              <p class="text-sm opacity-70">Last updated: <span id="last-checked">Loading...</span></p>
            </div>
            <div id="status-icon" class="text-2xl">✅</div>
          </div>

          <h3 class="text-lg font-bold mb-3 text-purple-300">Component Health</h3>
          <div id="components-list" class="space-y-3">
            <p class="text-center py-4">Loading component status...</p>
          </div>
        </div>

        <!-- Active Incidents -->
        <div class="card rounded-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-purple-300">Active Incidents</h2>
          <div id="active-incidents" class="space-y-4">
            <p class="text-center py-4">Loading incidents...</p>
          </div>
        </div>
      </div>

      <!-- Incident Statistics -->
      <div class="card rounded-lg p-6 mt-6">
        <h2 class="text-xl font-bold mb-4 text-purple-300">Incident Statistics</h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
          <div class="p-4 rounded-md bg-opacity-20 bg-purple-900 border border-purple-700">
            <h3 class="text-sm text-purple-300 mb-1">Total Incidents</h3>
            <p id="total-incidents" class="text-2xl font-bold">0</p>
          </div>
          <div class="p-4 rounded-md bg-opacity-20 bg-purple-900 border border-purple-700">
            <h3 class="text-sm text-purple-300 mb-1">Recent (24h)</h3>
            <p id="recent-incidents" class="text-2xl font-bold">0</p>
          </div>
          <div class="p-4 rounded-md bg-opacity-20 bg-purple-900 border border-purple-700">
            <h3 class="text-sm text-purple-300 mb-1">Critical Severity</h3>
            <p id="critical-incidents" class="text-2xl font-bold">0</p>
          </div>
          <div class="p-4 rounded-md bg-opacity-20 bg-purple-900 border border-purple-700">
            <h3 class="text-sm text-purple-300 mb-1">Avg. Resolution Time</h3>
            <p id="avg-resolution" class="text-2xl font-bold">0 min</p>
          </div>
        </div>
      </div>
    </main>

    <footer class="py-4 bg-gray-900">
      <div class="container mx-auto px-4">
        <p class="text-sm text-gray-500 text-center">© 2025 Chronos Vault - Triple-Chain Security Architecture</p>
      </div>
    </footer>
  </div>

  <script>
    // Update current time
    function updateTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleString();
    }
    
    // Format date to readable string
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString();
    }
    
    // Get system health
    async function getSystemHealth() {
      try {
        const response = await fetch('/api/health/status');
        const data = await response.json();
        
        if (data.status === 'success') {
          updateSystemStatus(data.data);
        }
      } catch (error) {
        console.error('Error fetching system health:', error);
      }
    }
    
    // Update system status UI
    function updateSystemStatus(data) {
      const statusElement = document.getElementById('system-status');
      const statusLabel = document.getElementById('status-label');
      const statusIcon = document.getElementById('status-icon');
      const lastChecked = document.getElementById('last-checked');
      
      statusLabel.textContent = data.status;
      lastChecked.textContent = formatDate(data.lastChecked);
      
      // Remove previous classes
      statusElement.classList.remove('optimal', 'good', 'degraded', 'critical');
      
      // Set status class and icon
      switch (data.status) {
        case 'OPTIMAL':
          statusElement.classList.add('optimal');
          statusIcon.textContent = '✅';
          break;
        case 'GOOD':
          statusElement.classList.add('good');
          statusIcon.textContent = '✅';
          break;
        case 'DEGRADED':
          statusElement.classList.add('degraded');
          statusIcon.textContent = '⚠️';
          break;
        case 'CRITICAL':
          statusElement.classList.add('critical');
          statusIcon.textContent = '🚨';
          break;
      }
      
      // Update component list
      const componentsList = document.getElementById('components-list');
      componentsList.innerHTML = '';
      
      Object.entries(data.components).forEach(([name, component]) => {
        const componentEl = document.createElement('div');
        componentEl.className = `p-3 rounded-md flex justify-between items-center mb-2 ${component.status.toLowerCase()}`;
        componentEl.innerHTML = `
          <div>
            <span class="font-bold">${name}</span>
            <div class="text-xs opacity-70">
              Latency: ${component.latencyMs}ms | Error Rate: ${component.errorRate * 100}%
            </div>
          </div>
          <div class="font-bold">${component.status}</div>
        `;
        componentsList.appendChild(componentEl);
      });
    }
    
    // Get active incidents
    async function getActiveIncidents() {
      try {
        const response = await fetch('/api/incidents/incidents?status=DETECTED&status=INVESTIGATING&status=MITIGATING');
        const data = await response.json();
        
        if (data.status === 'success') {
          updateActiveIncidents(data.data);
        }
      } catch (error) {
        console.error('Error fetching incidents:', error);
      }
    }
    
    // Update active incidents UI
    function updateActiveIncidents(incidents) {
      const incidentsContainer = document.getElementById('active-incidents');
      
      if (incidents.length === 0) {
        incidentsContainer.innerHTML = '<p class="text-center py-4">No active incidents</p>';
        return;
      }
      
      incidentsContainer.innerHTML = '';
      incidents.forEach(incident => {
        const severityClass = incident.severity.toLowerCase();
        const el = document.createElement('div');
        el.className = `p-4 rounded-md ${severityClass}`;
        
        el.innerHTML = `
          <div class="flex justify-between">
            <h3 class="font-bold">${incident.description}</h3>
            <span class="px-2 py-1 text-xs rounded-full bg-opacity-30 bg-black">${incident.severity}</span>
          </div>
          <div class="text-sm mt-2">
            <div>ID: ${incident.id}</div>
            <div>Type: ${incident.type}</div>
            <div>Status: ${incident.status}</div>
            <div>Detected: ${formatDate(incident.detectedAt)}</div>
            ${incident.component ? `<div>Component: ${incident.component}</div>` : ''}
          </div>
          <div class="mt-3">
            <h4 class="text-sm font-bold mb-1">Response Actions (${incident.responseActions.length})</h4>
            <ul class="text-xs space-y-1">
              ${incident.responseActions.map(action => `
                <li class="opacity-80">• ${action.description} (${action.status})</li>
              `).join('')}
            </ul>
          </div>
        `;
        
        incidentsContainer.appendChild(el);
      });
    }
    
    // Get incident statistics
    async function getIncidentStatistics() {
      try {
        const response = await fetch('/api/incidents/statistics');
        const data = await response.json();
        
        if (data.status === 'success') {
          updateIncidentStatistics(data.data);
        }
      } catch (error) {
        console.error('Error fetching incident statistics:', error);
      }
    }
    
    // Update incident statistics UI
    function updateIncidentStatistics(stats) {
      document.getElementById('total-incidents').textContent = stats.totalIncidents;
      document.getElementById('recent-incidents').textContent = stats.recentIncidents;
      document.getElementById('critical-incidents').textContent = stats.bySeverity.CRITICAL || 0;
      document.getElementById('avg-resolution').textContent = `${stats.averageResolutionTimeMinutes} min`;
    }
    
    // Initialize and set up refresh interval
    function initialize() {
      updateTime();
      getSystemHealth();
      getActiveIncidents();
      getIncidentStatistics();
      
      // Set refresh intervals
      setInterval(updateTime, 1000);
      setInterval(getSystemHealth, 10000);
      setInterval(getActiveIncidents, 10000);
      setInterval(getIncidentStatistics, 30000);
    }
    
    // Start once page is loaded
    document.addEventListener('DOMContentLoaded', initialize);
  </script>
</body>
</html>